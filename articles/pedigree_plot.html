<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedigree plotting details • Pedixplorer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pedigree plotting details">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Pedixplorer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pedigree_alignment.html">Pedigree alignment details</a>
    </li>
    <li>
      <a href="../articles/pedigree_kinship.html">Pedigree kinship() details</a>
    </li>
    <li>
      <a href="../articles/pedigree_object.html">Pedigree object</a>
    </li>
    <li>
      <a href="../articles/pedigree_plot.html">Pedigree plotting details</a>
    </li>
    <li>
      <a href="../articles/pedigree.html">Pedixplorer tutorial</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LouisLeNezet/Pedixplorer/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Pedigree plotting details</h1>
                        <h4 data-toc-skip class="author">TM Therneau, JP
Sinnwell, Louis Le Nézet</h4>
            
            <h4 data-toc-skip class="date">03 October, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/LouisLeNezet/Pedixplorer/blob/change_workflow/vignettes/pedigree_plot.Rmd" class="external-link"><code>vignettes/pedigree_plot.Rmd</code></a></small>
      <div class="hidden name"><code>pedigree_plot.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The plotting function for Pedigrees has 5 tasks</p>
<ol style="list-style-type: decimal">
<li>Gather information and check the data. An important step is the call
to align.</li>
<li>Set up the plot region and size the symbols. The program wants to
plot circles and squares, so needs to understand the geometry of the
paper, Pedigree size, and text size to get the right shape and size
symbols.</li>
<li>Set up the plot and add the symbols for each subject</li>
<li>Add connecting lines between spouses, and children with parents</li>
<li>Create an invisible return value containing the locations.</li>
</ol>
<p>Another task, not yet completely understood, and certainly not
implemented, is how we might break a plot across multiple pages.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The new version of the plotting Pedigree function works in two
step.</p>
<ul>
<li>
<strong>ped_to_plotdf()</strong> create a dataframe from a Pedigree
given containing all the necessary information to plot all the elements
of the Pedigree: “polygons”, “text”, “segments”, “arcs”</li>
<li>
<strong>plot_from_df()</strong> use a given dataframe and plot all
the element given</li>
</ul>
<p>The advantage of this two step method, is that all the plotting can
be parralelised, each element can be customised by the user if necessary
and additional elements can also be added to the plot by just adding a
new row.</p>
<p>If multiple families are present in the Pedigree object, then one
dataframe per family will be produced and the first one will be
plotted.</p>
<p>For more informations about those two functions, see the help
page.</p>
<ul>
<li><code><a href="../reference/ped_to_plotdf.html">help(ped_to_plotdf)</a></code></li>
<li><code><a href="../reference/plot_fromdf.html">help(plot_fromdf)</a></code></li>
</ul>
</div>
<div class="section level2">
<h2 id="sizing">Sizing<a class="anchor" aria-label="anchor" href="#sizing"></a>
</h2>
<p>Now we need to set the sizes. From <code><a href="../reference/align.html">align()</a></code> we will get
the maximum width and depth. There is one plotted row for each row of
the returned matrices. The number of columns of the matrices is the max
width of the Pedigree, so there are unused positions in shorter rows,
these can be identifed by having an nid value of 0. Horizontal locations
for each point go from 0 to xmax, subjects are at least 1 unit apart; a
large number will be exactly one unit part. These locations will be at
the top center of each plotted symbol.</p>
<div class="section level3">
<h3 id="set-the-graphical-parameters">Set the graphical parameters<a class="anchor" aria-label="anchor" href="#set-the-graphical-parameters"></a>
</h3>
<p>We would like to to make the boxes about 2.5 characters wide, which
matches most labels, but no more than 0.9 units wide or .5 units
high.<br>
We also want to vertical room for the labels. This is done by the
<code><a href="../reference/set_plot_area.html">set_plot_area()</a></code> function. We should have at least 1/2 of
<code>stemp2</code> space above and <code>stemp2</code> space
below.<br>
The <code>stemp3</code> variable is the height of labels: users may use
multi-line ones. Our constraints then are</p>
<ol style="list-style-type: decimal">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo>+</mo><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><mi>l</mi><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>l</mi><mi>e</mi><mi>v</mi><mo>≤</mo><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">(box height + label height) \times maxlev \le height</annotation></semantics></math>
: the boxes and labels have to fit vertically</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>l</mi><mi>e</mi><mi>v</mi><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>l</mi><mi>e</mi><mi>v</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">(box height) \times (maxlev + (maxlev-1)/2) \le height</annotation></semantics></math>
: at least 1/2 a box of space between each row of boxes</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>p</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">(box width) \le stemp1</annotation></semantics></math>
in inches</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">(box width) \le 0.8</annotation></semantics></math>
unit in user coordinates, otherwise they appear to touch</li>
<li>User coordinates go from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn><mi>/</mi><mn>2</mn><mi>b</mi><mi>o</mi><mi>x</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">min(xrange)- 1/2 box width</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mi>/</mi><mn>2</mn><mi>b</mi><mi>o</mi><mi>x</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">max(xrange) + 1/2 box width</annotation></semantics></math>.</li>
<li>the box is square (in inches)</li>
</ol>
<p>The first 3 of these are easy. The fourth comes into play only for
very packed pedigrees. Assume that the box were the maximum size of .8
units, i.e., minimal spacing between them. Then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>m</mi><mi>i</mi><mi>n</mi><mo>−</mo><mn>.45</mn></mrow><annotation encoding="application/x-tex">xmin -.45</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>+</mo><mn>.45</mn></mrow><annotation encoding="application/x-tex">xmax + .45</annotation></semantics></math>
covers the plot region, the scaling between user coordinates and inches
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>.8</mn><mo>+</mo><mi>x</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>x</mi><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(.8 + xmax-xmin)</annotation></semantics></math>
and the box is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>.8</mn><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mi>i</mi><mi>g</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>.8</mn><mo>+</mo><mi>x</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>x</mi><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">.8 \times (figure width) / (.8 + xmax-xmin)</annotation></semantics></math>.
The transformation from user units to inches horizontally depends on the
box size, since we need to allow for 1/2 a box on the left and
right.<br>
Vertically the range from 1 to nrow spans the tops of the symbols, which
will be the figure region height less (the height of the text for the
last row + 1 box); remember that the coordinates point to the top center
of the box. We want row 1 to plot at the top, which is done by
appropriate setting of the usr parameter.</p>
</div>
<div class="section level3">
<h3 id="subsetting-and-sub-region">Subsetting and Sub-Region<a class="anchor" aria-label="anchor" href="#subsetting-and-sub-region"></a>
</h3>
<p>This section is still experimental and might change. Also, in the
original documentation by TM Therneau, it is within the sizing section
above.</p>
<p>Sometimes a Pedigree is too large to fit comfortably on one page. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mi>r</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">subregion</annotation></semantics></math>
argument allows one to plot only a portion of the Pedigree based on the
plot region. Along with other tools to select portions of the Pedigree
based on relatedness, such as all the descendents of a particular
marriage, it gives a tool for addressing this. This breaks our original
goal of completely automatic plots, but users keep asking for more.</p>
<p>The argument is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mi>r</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mi>i</mi><mi>n</mi><mi>x</mi><mo>,</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi><mo>,</mo><mi>m</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo>,</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">subregion = c(min x, max x, min depth, max depth)</annotation></semantics></math>,
and works by editing away portions of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">plist</annotation></semantics></math>
object returned by align. First decide what lines to keep. Then take
subjects away from each line, update spouses and twins, and fix up
parentage for the line below.</p>
</div>
</div>
<div class="section level2">
<h2 id="ped_to_plotdf">ped_to_plotdf()<a class="anchor" aria-label="anchor" href="#ped_to_plotdf"></a>
</h2>
<p>This first function create the dataframe with the necessary plotting
information from a Pedigree object. The steps are:</p>
<ol style="list-style-type: decimal">
<li>Add boxes (depend on affection and sex) and marks.</li>
<li>Add status crossing if present.</li>
<li>Add id text and labels</li>
<li>Add in the connections, one by one, beginning with spouses.</li>
<li>Add connections children to parents.</li>
<li>Add lines/arcs to connect multiple instances of same subject.</li>
</ol>
<div class="section level3">
<h3 id="details-on-the-polygon-filling-and-border">Details on the polygon filling and border<a class="anchor" aria-label="anchor" href="#details-on-the-polygon-filling-and-border"></a>
</h3>
<p>Each polygon is named based on its shape (“square”,
“circle”,“diamond”, “triangle”), the total number of division of the
whole shape, and the position of the division to plot.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LouisLeNezet/Pedixplorer" class="external-link">Pedixplorer</a></span><span class="op">)</span></span>
<span><span class="va">types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"square_1_1"</span>, <span class="co"># Whole square</span></span>
<span>    <span class="st">"circle_2_1"</span>, <span class="co"># Semi circle first division</span></span>
<span>    <span class="st">"diamond_3_2"</span>, <span class="co"># Third of diamond second division</span></span>
<span>    <span class="st">"triangle_4_3"</span> <span class="co"># Fourth of triangle third division</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, y0 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    type <span class="op">=</span> <span class="va">types</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span><span class="op">)</span>,</span>
<span>    border <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    angle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">90</span>, <span class="fl">0</span>, <span class="fl">45</span><span class="op">)</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_fromdf.html">plot_fromdf</a></span><span class="op">(</span><span class="va">df</span>, usr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pedigree_plot_files/figure-html/polygons-1.png" alt="Different polygons" width="700"></p>
<p>The number of division will depend on the number of affection
register in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">fill</annotation></semantics></math>
slot of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">scale</annotation></semantics></math>
slot of the Pedigree. The filling will depend on the color given by the
corresponding modality for each individual, it is the same for the
border of the polygon.</p>
</div>
<div class="section level3">
<h3 id="details-on-connecting-children-to-parents-">Details on connecting children to parents.<a class="anchor" aria-label="anchor" href="#details-on-connecting-children-to-parents-"></a>
</h3>
<p>First there are lines up from each child, which would be trivial
except for twins, triplets, etc. Then we draw the horizontal bar across
siblings and finally the connector from the parent. For twins, the
<em>vertical</em> lines are angled towards a common point, the variable
is called
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">target</annotation></semantics></math>
below. The horizontal part is easier if we do things family by family.
The <code>plist$twins</code> variable is 1/2/3 for a twin on my right, 0
otherwise.</p>
</div>
<div class="section level3">
<h3 id="details-on-arcs-">Details on arcs.<a class="anchor" aria-label="anchor" href="#details-on-arcs-"></a>
</h3>
<p>The last set of lines are dotted arcs that connect mulitiple
instances of a subject on the same line. These instances may or may not
be on the same line. The arrcconect function draws a quadratic arc
between locations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mn>1</mn><mo>,</mo><mi>y</mi><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x1, y1)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>x</mi><mn>2</mn><mo>,</mo><mi>y</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">(x2, y2</annotation></semantics></math>)
whose height is 1/2 unit above a straight line connection.</p>
</div>
</div>
<div class="section level2">
<h2 id="plot_fromdf">plot_fromdf()<a class="anchor" aria-label="anchor" href="#plot_fromdf"></a>
</h2>
<div class="section level3">
<h3 id="polygons-drawing">Polygons drawing<a class="anchor" aria-label="anchor" href="#polygons-drawing"></a>
</h3>
<div class="section level4">
<h4 id="symbols">Symbols<a class="anchor" aria-label="anchor" href="#symbols"></a>
</h4>
<p>There are four sumbols corresponding to the four sex codes: square =
male, circle = female, diamond= unknown, and triangle =
terminated.<br>
They are shaded according to the value(s) of affected status for each
subject, and filling uses the standard arguments of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>g</mi><mi>o</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">polygon()</annotation></semantics></math>
function. The complexity is when multiple affected status are given, in
which case the symbol will be divided up into sections, clockwise
starting at the lower left. I asked Beth about this (original author)
and there was no particular reason to start at 6 o-clock, but it is now
established as history.</p>
<p>The first part of the code is to create the collection of polygons
that will make up the symbol. These are then used again and again. The
collection is kept as a list with the four elements square, circle,
diamond and triangle.</p>
<p>Each of these is in turn a list with
<code>max(fill(ped, "order"))</code> elements, and each of those in turn
a list of x and y coordinates.</p>
</div>
<div class="section level4">
<h4 id="circfun">Circfun<a class="anchor" aria-label="anchor" href="#circfun"></a>
</h4>
<p>The circle function is quite simple. The number of segments is
arbitrary, 50 seems to be enough to make the eye happy. We draw the ray
from 0 to the edge, then a portion of the arc. The polygon function will
connect back to the center.</p>
</div>
<div class="section level4">
<h4 id="polyfun">Polyfun<a class="anchor" aria-label="anchor" href="#polyfun"></a>
</h4>
<p>Now for the interesting one — dividing a polygon into ‘’pie slices’’.
In computing this we can’t use the usual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">y= a + bx</annotation></semantics></math>
formula for a line, because it doesn’t work for vertical ones (like the
sides of the square). Instead we use the alternate formulation in terms
of a dummy variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>x</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>a</mi><mo>+</mo><mi>b</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>c</mi><mo>+</mo><mi>d</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{eqnarray*}
    x &amp;=&amp; a + bz \\
    y &amp;=&amp; c + dz \\
\end{eqnarray*}</annotation></semantics></math></p>
<p>Furthermore, we choose the constants
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
so that the side of our polygon correspond to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>z</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \le z \le 1</annotation></semantics></math>.
The intersection of a particular ray at angle theta with a particular
side will satisfy</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>t</mi><mi>h</mi><mi>e</mi><mi>t</mi><mi>a</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mi>/</mi><mi>x</mi><mo>=</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mi>z</mi></mrow><mrow><mi>c</mi><mo>+</mo><mi>d</mi><mi>z</mi></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mfrac><mrow><mi>a</mi><mi>θ</mi><mo>−</mo><mi>c</mi></mrow><mrow><mi>b</mi><mo>−</mo><mi>d</mi><mi>θ</mi></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{eqnarray}
    theta &amp;=&amp; y/x = \frac{a + bz}{c+dz} \nonumber \\
    z &amp;=&amp; \frac{a\theta -c}{b - d\theta} \\
\end{eqnarray}</annotation></semantics></math></p>
<p>Equation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
will lead to a division by zero if the ray from the origin does not
intersect a side, e.g., a vertical divider will be parallel to the sides
of a square symbol. The only solutions we want have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>z</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \le z \le 1</annotation></semantics></math>
and are in the ‘’forward’’’ part of the ray. This latter is true if the
inner product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>cos</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>y</mi><mo>sin</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x \cos(\theta) + y \sin(\theta) &gt;0</annotation></semantics></math>.
Exactly one of the polygon sides will satisfy both conditions.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="final-output">Final output<a class="anchor" aria-label="anchor" href="#final-output"></a>
</h2>
<p>The Pedigree is plotted in a new frame or added to the current
device. If <code>ggplot_gen = TRUE</code>, then a ggplot object is
create with the same informations and available in the invisible object
given back by <em>plot_fromdf()</em></p>
<pre><code>Notes:
    Remind the user of subjects who did not get
    plotted; these are ususally subjects who are married in but without
    children.  Unless the Pedigree contains spousal information the
    routine does not know who is the spouse.
    Then restore the plot parameters.
    This would only not be done if someone wants to further annotate
    the plot.</code></pre>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] Pedixplorer_1.1.3 BiocStyle_2.32.1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] gtable_0.3.5        xfun_0.47           bslib_0.8.0        </span></span>
<span><span class="co">##  [4] ggplot2_3.5.1       htmlwidgets_1.6.4   lattice_0.22-6     </span></span>
<span><span class="co">##  [7] quadprog_1.5-8      vctrs_0.6.5         tools_4.4.1        </span></span>
<span><span class="co">## [10] generics_0.1.3      stats4_4.4.1        tibble_3.2.1       </span></span>
<span><span class="co">## [13] fansi_1.0.6         highr_0.11          pkgconfig_2.0.3    </span></span>
<span><span class="co">## [16] Matrix_1.7-0        data.table_1.16.0   desc_1.4.3         </span></span>
<span><span class="co">## [19] S4Vectors_0.42.1    readxl_1.4.3        lifecycle_1.0.4    </span></span>
<span><span class="co">## [22] stringr_1.5.1       compiler_4.4.1      shinytoastr_2.2.0  </span></span>
<span><span class="co">## [25] textshaping_0.4.0   munsell_0.5.1       httpuv_1.6.15      </span></span>
<span><span class="co">## [28] shinyWidgets_0.8.7  htmltools_0.5.8.1   sass_0.4.9         </span></span>
<span><span class="co">## [31] yaml_2.3.10         lazyeval_0.2.2      plotly_4.10.4      </span></span>
<span><span class="co">## [34] later_1.3.2         pillar_1.9.0        pkgdown_2.1.1      </span></span>
<span><span class="co">## [37] jquerylib_0.1.4     tidyr_1.3.1         DT_0.33            </span></span>
<span><span class="co">## [40] cachem_1.1.0        mime_0.12           tidyselect_1.2.1   </span></span>
<span><span class="co">## [43] digest_0.6.37       stringi_1.8.4       colourpicker_1.3.0 </span></span>
<span><span class="co">## [46] dplyr_1.1.4         purrr_1.0.2         bookdown_0.40      </span></span>
<span><span class="co">## [49] fastmap_1.2.0       grid_4.4.1          colorspace_2.1-1   </span></span>
<span><span class="co">## [52] cli_3.6.3           magrittr_2.0.3      utf8_1.2.4         </span></span>
<span><span class="co">## [55] scales_1.3.0        promises_1.3.0      rmarkdown_2.28     </span></span>
<span><span class="co">## [58] httr_1.4.7          gridExtra_2.3       cellranger_1.1.0   </span></span>
<span><span class="co">## [61] ragg_1.3.3          shiny_1.9.1         evaluate_1.0.0     </span></span>
<span><span class="co">## [64] knitr_1.48          miniUI_0.1.1.1      viridisLite_0.4.2  </span></span>
<span><span class="co">## [67] rlang_1.1.4         Rcpp_1.0.13         xtable_1.8-4       </span></span>
<span><span class="co">## [70] glue_1.8.0          BiocManager_1.30.25 BiocGenerics_0.50.0</span></span>
<span><span class="co">## [73] jsonlite_1.8.9      R6_2.5.1            plyr_1.8.9         </span></span>
<span><span class="co">## [76] systemfonts_1.1.0   fs_1.6.4</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Louis Le Nézet, Jason Sinnwell, Terry Therneau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
